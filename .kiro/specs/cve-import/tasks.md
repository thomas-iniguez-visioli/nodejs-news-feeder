# Implementation Plan - CVE Import

- [x] 1. Configure project for CVE collection





  - Add CVE configuration section to `config.json` with API endpoint, pagination limits, and optional API key support
  - Update package.json to add `collect:cves` script
  - _Requirements: 3.1, 3.4_

- [ ]* 1.1 Write example test for CVE configuration structure
  - Verify config.json contains required CVE settings
  - **Validates: Requirements 3.1, 3.4**

- [x] 2. Implement NVD API client functions





  - Create `fetchCVEs` function to call NVD API 2.0 with date filtering and pagination parameters
  - Implement rate limiting delays (6s without API key, 0.6s with API key)
  - Add API key support via environment variable `NVD_API_KEY`
  - Implement retry logic with exponential backoff for network failures
  - _Requirements: 1.1, 3.2_

- [ ]* 2.1 Write property test for API key authentication
  - **Property 6: API key authentication**
  - **Validates: Requirements 3.2**

- [x] 3. Implement pagination handler




  - Create `fetchAllCVEs` function that handles automatic pagination using `startIndex`
  - Respect `maxResults` configuration limit
  - Collect all CVE items across multiple pages
  - _Requirements: 1.5_

- [ ]* 3.1 Write property test for complete pagination handling
  - **Property 3: Complete pagination handling**
  - **Validates: Requirements 1.5, 5.2**

- [x] 4. Implement CVE data processor





  - Create `processCVEItem` function to extract CVE ID, description, publication date, CVSS score, and severity
  - Handle missing or malformed fields gracefully
  - Create `formatCVEForFeed` function to format processed CVE as feed item
  - Ensure title includes CVE ID, description includes CVSS score, link points to NVD details page
  - _Requirements: 1.2, 1.3, 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ]* 4.1 Write property test for complete CVE feed item formatting
  - **Property 1: Complete CVE feed item formatting**
  - **Validates: Requirements 1.2, 1.3, 4.1, 4.2, 4.3, 4.4, 4.5**

- [ ]* 4.2 Write property test for utility function consistency
  - **Property 7: Utility function consistency**
  - **Validates: Requirements 2.2**

- [x] 5. Implement timestamp-based filtering




  - Filter CVEs to include only those published after `lastCheckTimestamp`
  - Use `pubStartDate` parameter in API calls
  - _Requirements: 2.4, 3.5_

- [ ]* 5.1 Write property test for timestamp-based filtering
  - **Property 4: Timestamp-based filtering**
  - **Validates: Requirements 2.4, 3.5**

- [x] 6. Implement main collection script





  - Create `scripts/collect-cves.js` following the pattern of existing collection scripts
  - Load configuration from `config.json`
  - Call `fetchAllCVEs` with `lastCheckTimestamp`
  - Process each CVE using `processCVEItem` and `formatCVEForFeed`
  - Use `composeFeedItem` from utils for consistency
  - _Requirements: 2.1, 2.2_

- [ ] 7. Implement feed integration
  - Use `getFeedContent` to read existing feed
  - Split feed using `breakDelimiter`
  - Append new CVE feed items
  - Use `overwriteFeedContent` to update feed
  - Validate XML structure before writing
  - _Requirements: 1.4, 2.3_

- [ ]* 7.1 Write property test for feed integration with break delimiter
  - **Property 2: Feed integration with break delimiter**
  - **Validates: Requirements 1.4**

- [x] 8. Implement error handling and logging





  - Add try-catch blocks for API calls, data processing, and feed updates
  - Skip invalid CVE entries and continue processing
  - Preserve feed integrity on errors
  - Log number of CVEs processed and added
  - Log errors with details for debugging
  - _Requirements: 2.5, 5.4, 5.5_

- [ ]* 8.1 Write property test for graceful error handling
  - **Property 5: Graceful error handling**
  - **Validates: Requirements 2.5, 5.4**

- [ ]* 8.2 Write example test for logging behavior
  - Verify logs are produced with CVE count
  - **Validates: Requirements 5.5**

- [ ] 9. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [ ]* 10. Write unit tests for data processing functions
  - Test `processCVEItem` with various CVE structures
  - Test `formatCVEForFeed` with different data
  - Test date formatting edge cases
  - Test error handling for missing fields
  - _Requirements: 5.1, 5.3_

- [ ]* 11. Write integration tests for end-to-end flow
  - Test complete script execution with mock API responses
  - Test feed update with test feed file
  - Verify feed integrity after updates
  - _Requirements: 5.1, 5.2, 5.3_
